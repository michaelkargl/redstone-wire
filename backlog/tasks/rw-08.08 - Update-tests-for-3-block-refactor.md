---
id: RW-08.08
title: Update tests for 3-block refactor
status: To Do
assignee: []
created_date: '2026-02-14 19:42'
updated_date: '2026-02-14 19:51'
labels:
  - testing
milestone: m-1
dependencies:
  - RW-08.05
  - RW-08.06
  - RW-08.07
references:
  - src/main/java/tests/SimpleGameTests.java
  - src/main/java/tests/TestHelpers.java
parent_task_id: RW-08
priority: medium
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Update existing game tests and add new tests covering the three-block architecture.

Existing test updates:
- SimpleGameTests.leverinputoutputtest — Update to use RedstoneInputBlock and RedstoneOutputBlock instead of two generic RedstoneChainBlocks. The test structure .nbt file will need to be regenerated in-game with the correct block types.
- TestHelpers — assertChainBlocksAreConnected checks for RedstoneChainEntity (works unchanged), but may want to add type-specific assertion helpers

New test scenarios to add:
1. Input → Output direct cable: Lever → InputBlock --cable-- OutputBlock → Lamp
2. Input → Connector → Output: Lever → InputBlock --cable-- ConnectorBlock --cable-- OutputBlock → Lamp
3. Connector passivity: Verify ConnectorBlock does not emit signal to adjacent redstone
4. Input passivity: Verify InputBlock does not emit signal to adjacent redstone
5. Multiple inputs (strongest-wins): Two InputBlocks with different signal levels → Output gets the max
6. Network with no inputs: Output and Connector only → outputs stay at power 0
7. Legacy block still works: Existing RedstoneChainBlock behavior unchanged

Note: .nbt test structures are binary and must be regenerated in-game using /test create commands after placing the correct block types.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
- [ ] #1 Existing leverinputoutputtest updated for new block types
- [ ] #2 New test covers Input → Connector → Output signal chain
- [ ] #3 New test verifies Connector block does not emit redstone
- [ ] #4 New test verifies Input block does not emit redstone
- [ ] #5 Legacy RedstoneChainBlock test still passes
- [ ] #6 All tests compile and pass
<!-- AC:END -->

## Implementation Plan

<!-- SECTION:PLAN:BEGIN -->
## Implementation Plan

### 1. Update existing `leverinputoutputtest`
File: `src/main/java/tests/SimpleGameTests.java`

Change block name assertions from `"Redstone Chain"` to `"Redstone Input"` and `"Redstone Output"`:
```java
assertBlockNameAtPosition(helper, "Redstone Input", inputChainBlockPosition);
assertBlockNameAtPosition(helper, "Redstone Output", outputChainBlockPosition);
```

**Important**: The `.nbt` test structure must be regenerated in-game with the correct block types placed at those positions.

### 2. Add new test: `inputConnectorOutputTest`
```java
@GameTest(template = "inputconnectoroutputtest")
public static void inputConnectorOutputTest(GameTestHelper helper) {
    // Lever → InputBlock --cable-- ConnectorBlock --cable-- OutputBlock → Lamp/RedstoneWire
    // Verify: pulling lever powers the output
}
```

### 3. Add new test: `connectorDoesNotEmitTest`
```java
@GameTest(template = "connectornotemittest")
public static void connectorDoesNotEmitTest(GameTestHelper helper) {
    // ConnectorBlock with POWER set (via network) next to redstone wire
    // Verify: redstone wire is NOT powered
}
```

### 4. Add new test: `inputDoesNotEmitTest`
```java
@GameTest(template = "inputnotemittest")
public static void inputDoesNotEmitTest(GameTestHelper helper) {
    // InputBlock with POWER set (via lever) next to redstone wire on opposite side
    // Verify: redstone wire on non-lever side is NOT powered
}
```

### 5. Potentially add TestHelpers updates
- Add `assertBlockPowerLevel(helper, pos, expectedPower)` for checking POWER on new blocks
- Existing `assertChainBlocksAreConnected` works unchanged (checks `RedstoneChainEntity`)

### 6. Regenerate .nbt structures
This MUST be done in-game:
1. Run dev server + dev client
2. For each test: `/test create <classname>.<testname>`
3. Place blocks in the structure
4. Save the structure

### 7. Verify
- `./gradlew build` compiles
- `/test runall` in-game passes all tests
<!-- SECTION:PLAN:END -->

## Implementation Notes

<!-- SECTION:NOTES:BEGIN -->
## Implementation Notes

### .nbt structure regeneration is mandatory
Test structures are binary `.nbt` files stored at `src/main/resources/data/redstone_wire/gametest/structures/`. They contain the actual block placements for each test. When block types change (from legacy RedstoneChainBlock to new Input/Output blocks), the structures MUST be regenerated in-game because:
1. `.nbt` files encode block type IDs — changing from `redstone_wire:redstone_chain` to `redstone_wire:redstone_input` requires new structures
2. There's no way to edit `.nbt` files as text — they must be created via Minecraft's structure block system

### Test structure generation workflow
1. Start dev server: `./gradlew runServer`
2. Connect with dev client: `./gradlew runClient`
3. For each test method:
   - Run `/test create redstone_wire:simplegametests.<testname>` to create a structure block
   - Place blocks in the correct positions
   - Save the structure block (the `.nbt` file is written to the structures directory)

### Connector passivity test design
The trickiest test to set up is verifying that a Connector block doesn't emit power. Setup:
- Place a Connector block that is part of a powered network (Input → Connector → Output, lever on)
- Place redstone dust adjacent to the Connector (NOT the Output)
- Assert: redstone dust power = 0

This proves the Connector routes signal through the network but doesn't leak it to neighbors.

### Input passivity test design
Similar to connector test:
- Place Input block with lever on one side
- Place redstone dust on the OPPOSITE side of the Input (not between lever and block)
- Assert: redstone dust power = 0

This proves Input detects but doesn't emit.

### Existing test `assertChainBlocksAreConnected`
This helper checks `instanceof RedstoneChainEntity` (line 148-149 of TestHelpers.java). Since all new block types use the same entity, this works unchanged for all block type combinations.

### Block names for assertions
The block display names come from `en_us.json`:
- `"Redstone Input"` (from `block.redstone_wire.redstone_input`)
- `"Redstone Output"` (from `block.redstone_wire.redstone_output`)
- `"Redstone Connector"` (from `block.redstone_wire.redstone_connector`)
These must match exactly in `assertBlockNameAtPosition()` calls.
<!-- SECTION:NOTES:END -->

## Definition of Done
<!-- DOD:BEGIN -->
- [ ] #1 Existing `leverinputoutputtest` updated to use `RedstoneInputBlock` and `RedstoneOutputBlock` (block name assertions updated)
- [ ] #2 New test: Input → Connector → Output signal chain works end-to-end
- [ ] #3 New test: Connector block does NOT emit redstone signal to adjacent redstone wire
- [ ] #4 New test: Input block does NOT emit redstone signal to adjacent redstone wire
- [ ] #5 Test structure `.nbt` files regenerated in-game for updated/new tests
- [ ] #6 All test methods compile
- [ ] #7 All tests pass when run via `/test runall` in-game
- [ ] #8 Legacy block tests still pass (no regressions)
<!-- DOD:END -->
