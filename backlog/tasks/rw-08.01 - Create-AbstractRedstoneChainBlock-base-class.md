---
id: RW-08.01
title: Create AbstractRedstoneChainBlock base class
status: To Do
assignee: []
created_date: '2026-02-14 19:40'
updated_date: '2026-02-14 19:48'
labels:
  - refactor
milestone: m-1
dependencies: []
references:
  - src/main/java/at/osa/redstonewire/RedstoneChainBlock.java
parent_task_id: RW-08
priority: high
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Extract shared functionality from RedstoneChainBlock into a new abstract base class that all three new block types will extend.

Move to the base class:
- SHAPE constant and getShape() override
- EntityBlock implementation: newBlockEntity() (creates RedstoneChainEntity), getTicker() (returns null by default)
- onRemove() — bidirectional connection cleanup logic (iterates entity connections, removes bidirectional links, clears connections)
- onPlace() — empty by default (Input block will override)
- Constructor calls super(properties) but does NOT register POWER default state
- createBlockStateDefinition() — empty by default (subclasses add POWER if needed)

Does NOT include (these differ per subclass):
- findNetwork(), findPower(), tick() — adjacent-only logic stays in legacy RedstoneChainBlock
- isSignalSource(), getSignal(), getDirectSignal(), neighborChanged()
- hasAnalogOutputSignal(), getAnalogOutputSignal()

The existing RedstoneChainBlock.java remains unchanged as the legacy block.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
- [ ] #1 AbstractRedstoneChainBlock.java exists with shared block shape, EntityBlock implementation, and onRemove cleanup
- [ ] #2 Class is abstract and does not define POWER property or signal methods
- [ ] #3 newBlockEntity() creates RedstoneChainEntity
- [ ] #4 getTicker() returns null by default (Input block will override)
- [ ] #5 onRemove() properly cleans up bidirectional cable connections
- [ ] #6 Existing RedstoneChainBlock.java is unchanged
<!-- AC:END -->

## Implementation Plan

<!-- SECTION:PLAN:BEGIN -->
## Implementation Plan

### 1. Create `AbstractRedstoneChainBlock.java`
Location: `src/main/java/at/osa/redstonewire/AbstractRedstoneChainBlock.java`

### 2. Class structure
```java
public abstract class AbstractRedstoneChainBlock extends Block implements EntityBlock {
    private static final VoxelShape SHAPE = Shapes.block();

    public AbstractRedstoneChainBlock(Properties properties) {
        super(properties);
    }
    // getShape() — return SHAPE
    // newBlockEntity() — return new RedstoneChainEntity(pos, state)
    // getTicker() — return null (Input overrides)
    // onPlace() — no-op (Input overrides)
    // onRemove() — copy cleanup logic from RedstoneChainBlock lines 490-504
}
```

### 3. Key decisions
- Do NOT define `POWER` in the abstract class — Input/Output define their own
- Do NOT call `registerDefaultState()` — subclasses handle this
- `createBlockStateDefinition()` is empty by default — subclasses add POWER if needed
- `onRemove()` cleanup logic is identical for all 3 new block types, so it belongs here
- Import `RedstoneChainEntity` for `newBlockEntity()` and `onRemove()` instanceof checks

### 4. Verify
- `./gradlew build` compiles (class is unused at this point, but should compile)
- `git diff RedstoneChainBlock.java` shows no changes
<!-- SECTION:PLAN:END -->

## Implementation Notes

<!-- SECTION:NOTES:BEGIN -->
## Implementation Notes

### What to extract from RedstoneChainBlock
The following methods/fields should be moved to the abstract base class:
- `SHAPE` constant (line 56) and `getShape()` (lines 101-104)
- `newBlockEntity()` (lines 425-427)
- `getTicker()` — simplified to return `null` (Input will override)
- `onRemove()` (lines 490-505) — the bidirectional cleanup logic is shared
- `onPlace()` — provide empty default (Input will override with scheduleTick)

### What stays ONLY in RedstoneChainBlock (legacy)
- `POWER` property definition and `createBlockStateDefinition()`
- `isSignalSource()`, `getSignal()`, `getDirectSignal()`
- `neighborChanged()` with its adjacent-block fallback
- `tick()` with `findNetwork()`/`findPower()` for adjacent-only networks
- `hasAnalogOutputSignal()`, `getAnalogOutputSignal()`
- The constructor's `registerDefaultState(POWER=0)` call

### Why NOT make RedstoneChainBlock extend this class
The legacy block has completely different behavior (adjacent-touching networks, combined input/output). Making it extend the abstract class would either:
1. Force empty overrides of methods it doesn't need
2. Create confusion about which behavior is "real"
Keeping them separate is cleaner for a legacy block that will eventually be deprecated.

### onRemove cleanup pattern
The `onRemove()` in the abstract class iterates `chain.getConnections()`, removes bidirectional links, and calls `chain.clearConnections()`. This works identically for Input, Output, and Connector blocks since they all share `RedstoneChainEntity`.
<!-- SECTION:NOTES:END -->

## Definition of Done
<!-- DOD:BEGIN -->
- [ ] #1 New file `AbstractRedstoneChainBlock.java` exists in `at.osa.redstonewire` package
- [ ] #2 Class is `public abstract` and extends `Block` implements `EntityBlock`
- [ ] #3 Contains `SHAPE` constant (`Shapes.block()`) and `getShape()` override
- [ ] #4 Contains `newBlockEntity()` that creates `RedstoneChainEntity`
- [ ] #5 Contains `getTicker()` that returns `null` by default
- [ ] #6 Contains `onRemove()` with bidirectional connection cleanup (copy from RedstoneChainBlock lines 490-504)
- [ ] #7 Contains `onPlace()` as empty/no-op (subclasses override)
- [ ] #8 Contains empty `createBlockStateDefinition()` (no POWER property)
- [ ] #9 Does NOT contain: `findNetwork()`, `findPower()`, `tick()`, `isSignalSource()`, `getSignal()`, `getDirectSignal()`, `neighborChanged()`
- [ ] #10 RedstoneChainBlock.java is completely unchanged (verified via git diff)
- [ ] #11 Project compiles with `./gradlew build`
<!-- DOD:END -->
