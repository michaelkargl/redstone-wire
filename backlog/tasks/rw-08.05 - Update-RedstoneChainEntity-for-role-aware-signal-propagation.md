---
id: RW-08.05
title: Update RedstoneChainEntity for role-aware signal propagation
status: To Do
assignee: []
created_date: '2026-02-14 19:41'
labels:
  - refactor
milestone: m-1
dependencies:
  - RW-08.02
  - RW-08.03
  - RW-08.04
references:
  - src/main/java/at/osa/redstonewire/RedstoneChainEntity.java
parent_task_id: RW-08
priority: high
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Modify RedstoneChainEntity to be role-aware, checking block types at each network position to determine behavior.

Key changes:

1. computeNetworkInputPower() — Only scan neighbors of RedstoneInputBlock positions:
   - Add instanceof RedstoneInputBlock check, skip all other block types
   
2. getPowerFromDirection() — Update instanceof check to skip all chain-type blocks:
   - Change: `block instanceof RedstoneChainBlock` to `block instanceof AbstractRedstoneChainBlock || block instanceof RedstoneChainBlock`

3. applySignalToNetwork() — Skip Connector blocks (no POWER property):
   - Check instanceof RedstoneConnectorBlock and skip
   - For Input/Output blocks, safely read/write POWER via AbstractRedstoneChainBlock.POWER

4. getSignal() — Guard against Connector blocks:
   - If block is RedstoneConnectorBlock, return 0 (no POWER property to read)
   - Otherwise read POWER from block state as before

5. getConnectedChains() — No change needed (checks for RedstoneChainEntity which all types share)

Note: The POWER static field will be defined identically in both RedstoneInputBlock and RedstoneOutputBlock (both use BlockStateProperties.POWER). The entity should reference it via the block state safely.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
- [ ] #1 computeNetworkInputPower() only scans neighbors of RedstoneInputBlock positions
- [ ] #2 getPowerFromDirection() skips AbstractRedstoneChainBlock and legacy RedstoneChainBlock neighbors
- [ ] #3 applySignalToNetwork() skips RedstoneConnectorBlock (no POWER property)
- [ ] #4 getSignal() returns 0 for Connector blocks instead of crashing
- [ ] #5 Entity still works correctly with legacy RedstoneChainBlock in mixed networks
- [ ] #6 No regressions in feedback loop protection or signal loss delay
<!-- AC:END -->
